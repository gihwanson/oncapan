"""
AI ëŒ“ê¸€ ìƒì„± ëª¨ë“ˆ
- OpenAI GPTë¥¼ ì´ìš©í•œ ìì—°ìŠ¤ëŸ¬ìš´ ëŒ“ê¸€ ìƒì„±
- ì‹¤ì œ ëŒ“ê¸€ ëª¨ë°©ì— ì§‘ì¤‘
"""

from openai import OpenAI
import logging
from typing import Optional, List, Dict
import datetime
import re
from collections import Counter

logging.basicConfig(level=logging.INFO)
logger = logging.getLogger(__name__)

# httpx ë¡œê·¸ ë¹„í™œì„±í™”
logging.getLogger("httpx").setLevel(logging.WARNING)


class AICommentGenerator:
    def __init__(self, api_key: str):
        self.client = OpenAI(api_key=api_key)
        self.model = "gpt-3.5-turbo"
    
    def generate_comment(self, post_content: str, post_title: str = "", actual_comments: List[str] = None) -> Optional[str]:
        """
        ê²Œì‹œê¸€ ë‚´ìš©ì„ ë°”íƒ•ìœ¼ë¡œ ìì—°ìŠ¤ëŸ¬ìš´ ëŒ“ê¸€ ìƒì„±
        - post_title: ê²Œì‹œê¸€ ì œëª©
        - post_content: ê²Œì‹œê¸€ ë³¸ë¬¸
        - actual_comments: ì´ ê²Œì‹œê¸€ì— ì‹¤ì œë¡œ ë‹¬ë¦° ëŒ“ê¸€ ëª©ë¡ (ìµœìš°ì„ !)
        
        ì£¼ì˜: ì‹¤ì œ ëŒ“ê¸€ì´ ì—†ìœ¼ë©´ Noneì„ ë°˜í™˜í•˜ì—¬ ëŒ“ê¸€ ì‘ì„±ì„ ê±´ë„ˆëœë‹ˆë‹¤.
        """
        # ì‹¤ì œ ëŒ“ê¸€ì´ ì—†ìœ¼ë©´ ëŒ“ê¸€ ì‘ì„±í•˜ì§€ ì•ŠìŒ
        if not actual_comments or len(actual_comments) == 0:
            logger.info("ì‹¤ì œ ëŒ“ê¸€ì´ ì—†ëŠ” ê²Œì‹œê¸€ì€ ëŒ“ê¸€ ì‘ì„±í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.")
            return None
        
        max_retries = 3
        
        # í‚¤ì›Œë“œ ë¯¸ë¦¬ ì¶”ì¶œ (ê²€ì¦ìš©)
        keywords = self._extract_keywords(actual_comments) if actual_comments else []
        
        for attempt in range(max_retries):
            try:
                # ì•ˆì „í•œ ë¬¸ìì—´ ì²˜ë¦¬
                safe_title = self._safe_string(post_title)
                safe_content = self._safe_string(post_content[:500])  # ë³¸ë¬¸ì€ 500ìë¡œ ì œí•œ
                
                # ì‹¤ì œ ëŒ“ê¸€ì´ ìˆìœ¼ë©´ ë¬´ì¡°ê±´ ëª¨ë°© ëª¨ë“œ
                comment = self._generate_with_actual_comments(
                    safe_title, safe_content, actual_comments, keywords
                )
                
                if comment:
                    # ë¡œê·¸ ê°„ì†Œí™”: ìƒì„±ëœ ëŒ“ê¸€ë§Œ ê°„ë‹¨íˆ ì¶œë ¥
                    logger.debug(f"[ì‹œë„ {attempt + 1}] ìƒì„±ëœ ëŒ“ê¸€: {comment}")
                    
                    # í‚¤ì›Œë“œ í¬í•¨ ì—¬ë¶€ í™•ì¸
                    if keywords:
                        if not self._validate_keywords_in_comment(comment, keywords):
                            logger.warning(f"[ì‹œë„ {attempt + 1}] í‚¤ì›Œë“œ ë¯¸í¬í•¨ìœ¼ë¡œ í•„í„°ë§. ì›ë³¸: '{comment}', í‚¤ì›Œë“œ: {keywords}")
                            if attempt < max_retries - 1:
                                import time
                                time.sleep(0.5)  # ì¬ì‹œë„ ëŒ€ê¸° ì‹œê°„ ì¤„ì„
                                continue
                            else:
                                logger.error(f"[ì‹œë„ {attempt + 1}] í‚¤ì›Œë“œ í¬í•¨ ì‹¤íŒ¨. ìµœëŒ€ ì¬ì‹œë„ íšŸìˆ˜ ë„ë‹¬.")
                    
                    # í›„ì²˜ë¦¬
                    processed_comment = self._post_process(comment)
                    
                    # í›„ì²˜ë¦¬ í›„ì—ë„ ìœ íš¨í•œ ëŒ“ê¸€ì´ë©´ ë°˜í™˜
                    if processed_comment:
                        # í‚¤ì›Œë“œ ì¬í™•ì¸ (í›„ì²˜ë¦¬ í›„)
                        if keywords:
                            if not self._validate_keywords_in_comment(processed_comment, keywords):
                                logger.warning(f"[ì‹œë„ {attempt + 1}] í›„ì²˜ë¦¬ í›„ í‚¤ì›Œë“œ ë¯¸í¬í•¨. ì›ë³¸: '{comment}' -> ì²˜ë¦¬ í›„: '{processed_comment}', í‚¤ì›Œë“œ: {keywords}")
                                if attempt < max_retries - 1:
                                    import time
                                    time.sleep(0.5)  # ì¬ì‹œë„ ëŒ€ê¸° ì‹œê°„ ì¤„ì„
                                    continue
                                else:
                                    logger.error(f"[ì‹œë„ {attempt + 1}] í›„ì²˜ë¦¬ í›„ í‚¤ì›Œë“œ í¬í•¨ ì‹¤íŒ¨. ìµœëŒ€ ì¬ì‹œë„ íšŸìˆ˜ ë„ë‹¬.")
                        
                        # ë””ë²„ê·¸ ë¡œê·¸ ê¸°ë¡
                        self._log_generation(post_title, post_content, actual_comments, processed_comment)
                        return processed_comment
                    else:
                        # í›„ì²˜ë¦¬ì—ì„œ í•„í„°ë§ëœ ê²½ìš° ì¬ì‹œë„
                        logger.warning(f"[ì‹œë„ {attempt + 1}] í›„ì²˜ë¦¬ì—ì„œ í•„í„°ë§ë¨. ì›ë³¸: '{comment}' -> None")
                        if attempt < max_retries - 1:
                            import time
                            time.sleep(0.5)  # ì¬ì‹œë„ ëŒ€ê¸° ì‹œê°„ ì¤„ì„
                            continue
                        else:
                            logger.error(f"[ì‹œë„ {attempt + 1}] ìµœëŒ€ ì¬ì‹œë„ íšŸìˆ˜ ë„ë‹¬. ëŒ“ê¸€ ìƒì„± ì‹¤íŒ¨.")
                else:
                    logger.warning(f"[ì‹œë„ {attempt + 1}] _generate_with_actual_commentsê°€ Noneì„ ë°˜í™˜í–ˆìŠµë‹ˆë‹¤.")
                    if attempt < max_retries - 1:
                        logger.info(f"[ì‹œë„ {attempt + 1}] ì¬ì‹œë„ ëŒ€ê¸° ì¤‘...")
                        import time
                        time.sleep(0.5)  # ì¬ì‹œë„ ëŒ€ê¸° ì‹œê°„ ì¤„ì„
                        continue
                    else:
                        logger.error(f"[ì‹œë„ {attempt + 1}] ìµœëŒ€ ì¬ì‹œë„ íšŸìˆ˜ ë„ë‹¬. ëŒ“ê¸€ ìƒì„± ì‹¤íŒ¨.")
                    
            except Exception as e:
                logger.error(f"ëŒ“ê¸€ ìƒì„± ì˜¤ë¥˜ (ì‹œë„ {attempt + 1}/{max_retries}): {e}")
                import traceback
                logger.error(f"íŠ¸ë ˆì´ìŠ¤ë°±: {traceback.format_exc()}")
                if attempt < max_retries - 1:
                    import time
                    time.sleep(0.5)  # ì¬ì‹œë„ ëŒ€ê¸° ì‹œê°„ ì¤„ì„
                    continue
                return None
        
        logger.error("ëª¨ë“  ì¬ì‹œë„ ì‹¤íŒ¨. None ë°˜í™˜")
        return None
    
    def _extract_keywords(self, comments: List[str]) -> List[str]:
        """ëŒ“ê¸€ì—ì„œ ê°€ì¥ ë§ì´ ë‚˜ì˜¨ í‚¤ì›Œë“œ ì¶”ì¶œ (ë¶€ë¶„ ë¬¸ìì—´ í¬í•¨)"""
        # ëª¨ë“  ëŒ“ê¸€ì—ì„œ í•œê¸€ ë‹¨ì–´ ì¶”ì¶œ (ë¶€ë¶„ ë¬¸ìì—´ë„ í¬í•¨)
        all_words = []
        for comment in comments:
            # í•œê¸€ë§Œ ì¶”ì¶œ
            korean_text = re.sub(r'[^ê°€-í£]', '', comment)
            
            # 2-5ê¸€ì ê¸¸ì´ì˜ ëª¨ë“  ë¶€ë¶„ ë¬¸ìì—´ ì¶”ì¶œ
            for length in range(2, min(6, len(korean_text) + 1)):
                for i in range(len(korean_text) - length + 1):
                    word = korean_text[i:i+length]
                    if len(word) >= 2:
                        all_words.append(word)
        
        # ë¹ˆë„ìˆ˜ ê³„ì‚°
        word_counter = Counter(all_words)
        
        # ì œì™¸í•  ì¼ë°˜ì ì¸ ë‹¨ì–´ë“¤ ë° ì–´ë¯¸/ì ‘ë¯¸ì‚¬
        exclude_words = {
            'ì¢‹ì•„ìš”', 'ë§ì•„ìš”', 'ìˆ˜ê³ ', 'ê³µê°', 'ì •ë³´', 'ê°ì‚¬', 'ê³ ë§ˆì›Œ', 'ê³ ë§ˆì›Œìš”',
            'ì¢‹ì•„', 'ë§ì•„', 'ê·¸ë˜', 'ê·¸ë ‡', 'ì´ê±°', 'ì €ê±°', 'ì´ê²ƒ', 'ì €ê²ƒ',
            'ë•Œë¬¸', 'ë•Œë¬¸ì—', 'ê·¸ë˜ì„œ', 'ê·¸ëŸ°ë°', 'ê·¸ë¦¬ê³ ', 'í•˜ì§€ë§Œ', 'ê·¸ëŸ¬ë‚˜',
            'ëŒ“ê¸€', 'ê²Œì‹œê¸€', 'ì‘ì„±', 'ë“±ë¡', 'ìˆ˜ì •', 'ì‚­ì œ', 'ì‹ ê³ ',
            'ì˜¤ëŠ˜', 'ë‚´ì¼', 'ì–´ì œ', 'ì§€ê¸ˆ', 'ì´ì œ', 'ê·¸ë•Œ', 'ì–¸ì œ',
            'ì—¬ê¸°', 'ì €ê¸°', 'ê±°ê¸°', 'ì–´ë””', 'ì–´ë””ì„œ', 'ì–´ë””ì—',
            'ì´ë ‡ê²Œ', 'ì €ë ‡ê²Œ', 'ê·¸ë ‡ê²Œ', 'ì–´ë–»ê²Œ', 'ì™œ', 'ë¬´ì—‡', 'ë¬´ìŠ¨',
            'ìˆì–´', 'ì—†ì–´', 'ìˆë„¤', 'ì—†ë„¤', 'ìˆì–´ìš”', 'ì—†ì–´ìš”',
            'ë˜ë„¤', 'ë˜ë„¤ìš”', 'ë˜ë‚˜', 'ë˜ë‚˜ìš”', 'ë˜ëŠ”', 'ë˜ëŠ”ë°',
            'ê°€ë„¤', 'ê°€ë„¤ìš”', 'ê°€ë‚˜', 'ê°€ë‚˜ìš”', 'ê°€ëŠ”', 'ê°€ëŠ”ë°',
            'í•˜ë„¤', 'í•˜ë„¤ìš”', 'í•˜ë‚˜', 'í•˜ë‚˜ìš”', 'í•˜ëŠ”', 'í•˜ëŠ”ë°',
            'ë³´ë„¤', 'ë³´ë„¤ìš”', 'ë³´ë‚˜', 'ë³´ë‚˜ìš”', 'ë³´ëŠ”', 'ë³´ëŠ”ë°',
            'ë¨¹ë„¤', 'ë¨¹ë„¤ìš”', 'ë¨¹ë‚˜', 'ë¨¹ë‚˜ìš”', 'ë¨¹ëŠ”', 'ë¨¹ëŠ”ë°',
            'ë“œë„¤', 'ë“œë„¤ìš”', 'ë“œë‚˜', 'ë“œë‚˜ìš”', 'ë“œëŠ”', 'ë“œëŠ”ë°',
            'í•´ì•¼', 'í•´ì•¼ì§€', 'í•´ì•¼ì§€', 'í•´ì•¼', 'í•´ì•¼', 'í•´ì•¼',
        }
        
        # í•œê¸€ ì–´ë¯¸/ì ‘ë¯¸ì‚¬ íŒ¨í„´ (ì¤‘ë³µ ì œê±°)
        suffix_patterns = {
            # 2ê¸€ì ì–´ë¯¸
            'ë„¤ìš”', 'ë‚˜ìš”', 'ì–´ìš”', 'ì•„ìš”', 'ì—ìš”', 'ì˜ˆìš”', 'ì„¸ìš”',
            'ë„¤', 'ë‚˜', 'ì–´', 'ì•„', 'ì—', 'ì˜ˆ', 'ì„¸',
            'ëŠ”ë°', 'ì€ë°', 'ì¸ë°',
            'ê³ ìš”', 'êµ¬ìš”',
            'ì§€ìš”', 'ì£ ',
            'ì–´ì•¼', 'ì•„ì•¼',
            'ê±°ë“ ', 'ê±°ë“ ìš”',
            'ë”ë¼', 'ë”ë¼ê³ ',
            'ë˜ë°', 'ë˜ë°ìš”',
            'ëŠ”êµ°', 'ëŠ”êµ°ìš”',
            'ëŠ”êµ¬', 'ëŠ”êµ¬ë‚˜',
            'ëŠ”ê±¸', 'ëŠ”ê±¸ìš”',
            'ëŠ”ì§€', 'ëŠ”ì§€ìš”',
            'ì„ê¹Œ', 'ì„ê¹Œìš”',
            'ì„ë˜', 'ì„ë˜ìš”',
            'ì„ê²Œ', 'ì„ê²Œìš”',
            'ìŠµë‹ˆë‹¤', 'ìŠµë‹ˆê¹Œ',
        }
        
        # ì–´ë¯¸/ì ‘ë¯¸ì‚¬ ì œì™¸ í•¨ìˆ˜
        def is_suffix(word: str) -> bool:
            """ë‹¨ì–´ê°€ ì–´ë¯¸/ì ‘ë¯¸ì‚¬ì¸ì§€ í™•ì¸"""
            # ì •í™•íˆ ì¼ì¹˜í•˜ëŠ” ì–´ë¯¸
            if word in suffix_patterns:
                return True
            
            # 2-3ê¸€ì ë‹¨ì–´ê°€ ì–´ë¯¸ë¡œ ëë‚˜ëŠ” ê²½ìš° (ì˜ë¯¸ ìˆëŠ” ë‹¨ì–´ê°€ ì•„ë‹Œ ê²½ìš°)
            if len(word) <= 3:
                # ì¼ë°˜ì ì¸ ì–´ë¯¸ ì¢…ê²°ì–´ë¯¸
                suffix_endings = ['ìš”', 'ë„¤', 'ë‚˜', 'ì–´', 'ì•„', 'ì—', 'ì˜ˆ', 'ì„¸', 'ë°', 'ì£ ', 'ê¹Œ', 'ë˜', 'ê²Œ', 'ì§€', 'êµ°', 'êµ¬', 'ê±¸', 'ë¼', 'ëŸ¬', 'ë¡œ', 'ë£¨', 'ë¥´']
                if word[-1] in suffix_endings:
                    # 2ê¸€ìì´ê³  ì–´ë¯¸ë¡œ ëë‚˜ëŠ” ê²½ìš°
                    if len(word) == 2:
                        return True
                    # 3ê¸€ìì´ê³  ì¼ë°˜ì ì¸ ì–´ë¯¸ íŒ¨í„´ì¸ ê²½ìš°
                    if len(word) == 3 and word[-2:] in ['ë„¤ìš”', 'ë‚˜ìš”', 'ì–´ìš”', 'ì•„ìš”', 'ì—ìš”', 'ì˜ˆìš”', 'ì„¸ìš”', 'ëŠ”ë°', 'ì€ë°', 'ì¸ë°', 'ëŠ”êµ°', 'ëŠ”êµ¬', 'ëŠ”ê±¸', 'ëŠ”ì§€', 'ì„ê¹Œ', 'ì„ë˜', 'ì„ê²Œ']:
                        return True
            
            return False
        
        # ë¹ˆë„ìˆ˜ ë†’ì€ í‚¤ì›Œë“œ ì¶”ì¶œ (ìµœì†Œ 2ë²ˆ ì´ìƒ ë‚˜ì˜¨ ë‹¨ì–´, ì œì™¸ ë‹¨ì–´ ë° ì–´ë¯¸ ì œì™¸)
        keywords = [
            word for word, count in word_counter.most_common(20)
            if count >= 2 and word not in exclude_words and len(word) >= 2 and not is_suffix(word)
        ]
        
        # ì¤‘ë³µ ì œê±° (ê¸´ ë‹¨ì–´ê°€ ì§§ì€ ë‹¨ì–´ë¥¼ í¬í•¨í•˜ëŠ” ê²½ìš° ê¸´ ë‹¨ì–´ ìš°ì„ )
        filtered_keywords = []
        for keyword in keywords:
            is_substring = False
            for other in keywords:
                if keyword != other and keyword in other and len(other) > len(keyword):
                    is_substring = True
                    break
            if not is_substring:
                filtered_keywords.append(keyword)
        
        # ë¡œê·¸ëŠ” GUIì—ì„œë§Œ í‘œì‹œ
        
        return filtered_keywords[:3]  # ìƒìœ„ 3ê°œë§Œ ë°˜í™˜
    
    def _generate_with_actual_comments(self, title: str, content: str, actual_comments: List[str], keywords: List[str] = None) -> Optional[str]:
        """ì‹¤ì œ ëŒ“ê¸€ì„ ëª¨ë°©í•˜ì—¬ ëŒ“ê¸€ ìƒì„±"""
        # ì‹¤ì œ ëŒ“ê¸€ ëª©ë¡ ì •ë¦¬
        comments_list = []
        for comment in actual_comments:
            comment_text = comment if isinstance(comment, str) else comment.get('content', str(comment))
            if comment_text and len(comment_text.strip()) > 2:
                comments_list.append(comment_text.strip())
        
        if not comments_list:
            return None
        
        # í‚¤ì›Œë“œ ì¶”ì¶œ (ê°€ì¥ ë§ì´ ë‚˜ì˜¨ ë‹¨ì–´) - ì „ë‹¬ë°›ì§€ ì•Šì€ ê²½ìš°ì—ë§Œ ì¶”ì¶œ
        if keywords is None:
            keywords = self._extract_keywords(comments_list)
        keyword_text = ""
        if keywords:
            if len(keywords) == 1:
                keyword_text = f"\n\n**ğŸ”‘ ì¤‘ìš” í‚¤ì›Œë“œ (ë°˜ë“œì‹œ í¬í•¨í•´ì•¼ í•¨!):**\n"
                keyword_text += f"ì´ ëŒ“ê¸€ë“¤ì—ì„œ ê°€ì¥ ë§ì´ ë‚˜ì˜¨ í‚¤ì›Œë“œ: **{keywords[0]}**\n"
                keyword_text += f"ìƒì„±í•˜ëŠ” ëŒ“ê¸€ì— ì´ í‚¤ì›Œë“œë¥¼ **ë°˜ë“œì‹œ í¬í•¨**í•˜ì„¸ìš”!"
            else:
                keyword_text = f"\n\n**ğŸ”‘ ì¤‘ìš” í‚¤ì›Œë“œ (í•˜ë‚˜ë§Œ ì„ íƒí•´ì„œ í¬í•¨!):**\n"
                keyword_text += f"ì´ ëŒ“ê¸€ë“¤ì—ì„œ ê°€ì¥ ë§ì´ ë‚˜ì˜¨ í‚¤ì›Œë“œë“¤: **{', '.join(keywords)}**\n"
                keyword_text += f"âš ï¸ **ì¤‘ìš”**: ì´ í‚¤ì›Œë“œ ì¤‘ **ì˜¤ì§ í•˜ë‚˜ë§Œ** ì„ íƒí•´ì„œ ëŒ“ê¸€ì— í¬í•¨í•˜ì„¸ìš”!\n"
                keyword_text += f"ì—¬ëŸ¬ í‚¤ì›Œë“œë¥¼ ë™ì‹œì— ì‚¬ìš©í•˜ë©´ ì•ˆ ë©ë‹ˆë‹¤. í•˜ë‚˜ë§Œ ì„ íƒí•˜ì„¸ìš”!"
        
        # ì‹¤ì œ ëŒ“ê¸€ ì˜ˆì‹œ (ìµœëŒ€ 15ê°œ)
        examples = comments_list[:15]
        examples_text = "\n".join([f"{i+1}. {c}" for i, c in enumerate(examples)])
        
        # í‰ê·  ê¸¸ì´ ê³„ì‚° (ìµœëŒ€ 10ê¸€ìë¡œ ì œí•œ)
        avg_len = min(sum(len(c) for c in comments_list) // len(comments_list) if comments_list else 10, 10)
        
        # ê²Œì‹œê¸€ ì œëª©ê³¼ ë³¸ë¬¸ ì •ë³´ êµ¬ì„±
        post_context = ""
        if title or content:
            post_context = "\n\n**ğŸ“„ ê²Œì‹œê¸€ ì •ë³´ (ë§¥ë½ íŒŒì•…ìš©):**\n"
            if title:
                post_context += f"ì œëª©: {title}\n"
            if content:
                # ë³¸ë¬¸ì€ ìµœëŒ€ 200ìë¡œ ì œí•œ (ë„ˆë¬´ ê¸¸ë©´ ë§¥ë½ íŒŒì•…ì´ ì–´ë ¤ì›€)
                content_preview = content[:200] + ("..." if len(content) > 200 else "")
                post_context += f"ë³¸ë¬¸: {content_preview}\n"
            post_context += "\nâš ï¸ **ì¤‘ìš”**: ìœ„ ê²Œì‹œê¸€ì˜ ë§¥ë½ì„ ì´í•´í•˜ê³ , ì‹¤ì œ ëŒ“ê¸€ë“¤ì˜ ìŠ¤íƒ€ì¼ì„ ìœ ì§€í•˜ë©´ì„œ ê²Œì‹œê¸€ ë‚´ìš©ê³¼ ê´€ë ¨ëœ ëŒ“ê¸€ì„ ì‘ì„±í•˜ì„¸ìš”!"
        
        # ì»¤ë®¤ë‹ˆí‹° ìš©ì–´ ì‚¬ì „ (ë§¥ë½ ì´í•´ìš©)
        community_terms = """
**ğŸ“š ì»¤ë®¤ë‹ˆí‹° ìš©ì–´ ì‚¬ì „ (ë§¥ë½ ì´í•´ìš©):**
- ë§›ë“œ: ë§›ìˆê²Œë“œì„¸ìš”
- ë§›ì•„: ë§›ìˆëŠ” ì•„ì¹¨
- ë§›ì : ë§›ìˆëŠ” ì ì‹¬
- ë§›ì €: ë§›ìˆëŠ” ì €ë…
- ë§›ë‹´: ë§›ìˆëŠ”ë‹´ë°°
- ë§›ì»¤: ë§›ìˆëŠ” ì»¤í”¼
- ë§›ì•¼ì‹: ë§›ìˆëŠ” ì•¼ì‹
- ë§›ì»¤ë‹´: ë§›ìˆëŠ” ì»¤í”¼ì™€ë‹´ë°°
- ë§›ëŒ€ê¸°: ë§›ìˆëŠ” ì¶œì„ì²´í¬ëŒ€ê¸°
- ë§›í¬ì»¤: ë§›ìˆëŠ” í¬ì»¤ê²Œì„(ê·¸ë§Œí¼ ì¦ê¸°ë¼ëŠ”ëœ»)
- í™”ë ¥ì—…: í™œë™ì¸ì›ì´ ì¤„ì€ ì‹œê°„ì— ê²Œì‹œê¸€ì„ ì¨ì„œ ê²Œì‹œíŒ í™œì„±í™”ë¥¼ í•´ë³´ìëŠ”ëœ»
- ì˜¤ì¶œì™„: ì˜¤ëŠ˜ì¶œì„ì²´í¬ì™„ë£Œ (ì˜¤ì¶”ë¡¼, ì˜¤ì¶œì™€ë‹ˆ, ì˜¤ì¶”ë¡¼ ë“±ìœ¼ë¡œë„ í‘œí˜„)
- ëŠ¦ì¶œ: ëŠ¦ì€ ì¶œì„ì²´í¬ (ëŠ¦ì¶œì™„: ëŠ¦ì€ì¶œì„ì²´í¬ ì™„ë£Œ)
- ê¹Ší‹°: ê¸°í”„í‹°ì½˜
- ê¹Šì „: ê¸°í”„í‹°ì½˜ ì „í™˜
- í¬ì „: í¬ì¸íŠ¸ì „í™˜
- í¬ë°”: í¬ì¸íŠ¸ë°”ì¹´ë¼(í¬ì¸íŠ¸ë¡œë°”ì¹´ë¼ë¥¼ í•˜ëŠ”ê²ƒ)
- ëŒ“ë…¸: ëŒ“ê¸€ë…¸ê°€ë‹¤ì˜ ì¤„ì„ë§(ëŒ“ê¸€ì„ ì˜¤ë˜ì¨ì„œ ë…¸ê°€ë‹¤ë§Œí¼ ì—´ì‹¬íˆí•œë‹¤ëŠ”ëœ»)
- ëŒ“ë…¸ íŒŒíŠ¸ë„ˆ: ëŒ“ê¸€ë§Œ ì“°ê¸° í˜ë“œë‹ˆ ìœ íŠœë¸Œë‚˜ ë‹¤ë¥¸ ë³¼ê±°ë¦¬ë¥¼ ëŒ“ë…¸íŒŒíŠ¸ë„ˆë¼ê³  í•¨
- ëŒ“ë…¸ë¯¸: ëŒ“ê¸€ ë…¸ê°€ë‹¤ê°€ ë¯¸ë˜ë‹¤ì˜ ì¤„ì„ë§
- ì»¤í”¼ê²œ/ì»¤í”¼ê²Œì„: ë„ë°•ì‚¬ì´íŠ¸ì—ì„œ ì•„ì¹¨ì— ì¶œê·¼ì‹œê°„ì— ì…ê¸ˆì‹œ ì»¤í”¼ì¿ í°ì„ì¤Œ
- í”¼ëª©: í”¼ë‚˜ëŠ” ëª©ìš”ì¼ì˜ ì¤„ì„ë§(ì“°ë‚˜ë¯¸ê°€ ë§ì´ ë‚˜ì˜¨ ë‚  or ì—­ë°°ê°€ ë§ì´ë‚˜ì˜¨ë‚ )
- ë…ì‚¬: í¬ì¸íŠ¸ë°”ì¹´ë¼ë¥¼ ì§„í–‰í•˜ëŠ” ì¹´ì§€ë…¸ë”œëŸ¬
- í”Œì¤„: í”Œë ˆì´ì–´ì˜ ì—°ì†ë“±ì¥
- ë±…ì¤„: ë±…ì»¤ì˜ ì—°ì†ë“±ì¥
- í”Œêº¾: ë±…ì»¤ì˜ ì—°ì†ë“±ì¥ìœ¼ë¡œ ë‹¤ìŒë²ˆì—” í”Œë ˆì´ì–´ê°€ ë‚˜ì˜¬ê±°ë¼ ìƒê°í•´ì„œ í”Œë ˆì´ì–´ë¡œ êº¾ì–´ë°°íŒ…í•˜ëŠ”í–‰ìœ„
- ë±…êº¾: í”Œë ˆì´ì–´ì˜ ì—°ì†ë“±ì¥ìœ¼ë¡œ ë‹¤ìŒë²ˆì—” ë±…ì»¤ê°€ ë‚˜ì˜¬ê±°ë¼ ìƒê°í•´ì„œ ë±…ì»¤ë¡œ êº¾ì–´ë°°íŒ…í•˜ëŠ”í–‰ìœ„
- ì¼ë³µ: ì¼ì¼ë³µê¶Œì˜ ì¤„ì„ë§
- ì£¼ë³µ: ì£¼ê°„ë³µê¶Œì˜ ì¤„ì„ë§
- 0í¬: í¬ì¸íŠ¸ê°€ 0ì´ë˜ì—ˆë‹¤ëŠ”ë§
- 0í¬ì¡±: í¬ì¸íŠ¸ê°€ 0ì´ëœ ì‚¬ëŒë“¤ì˜ ì§‘ë‹¨
- í¬: í¬ì¸íŠ¸ì˜ ì¤„ì„ë§
- ìŠˆ: ë°”ì¹´ë¼ì˜ 6ë§¤
- ì²«ìŠˆ: ë°”ì¹´ë¼ 6ë§¤ì˜ ì œì¼ ì²«ë²ˆì§¸ ë°°íŒ…
- ì¥ì‘: ê²Œì‹œê¸€ì„ ì“°ëŠ”í–‰ìœ„(ê²Œì‹œê¸€ì— ëŒ“ê¸€ì“°ë©´ í¬ì¸íŠ¸ë¥¼ ì£¼ë‹ˆê¹Œ ë³¸ì¸ì´ ê²Œì‹œê¸€ì„ ì‘ì„±í–ˆë‹¤ëŠ”ëœ»)
- 300í¬: ê²Œì‹œê¸€ì„ ì‘ì„±í•˜ë©´ ì£¼ëŠ” í¬ì¸íŠ¸
- í›ˆì¹´íŒ: í›ˆí›ˆí•œ ì˜¨ì¹´íŒì˜ ì¤„ì„ë§(ì£¼ë¡œ ëˆì„ ë§ì´ ë”´ ìœ ì €ê°€ ë”´ëˆì˜ ì†Œì•¡ì„ ë‚˜ëˆ ì¤„ë•Œ ë‚˜ì˜¤ëŠ” ë§)
- ìŠ¬ë¡¯: ì¹´ì§€ë…¸ì˜ ìŠ¬ë¡¯ê²Œì„
- ë§¥ìŠ¤: ëˆì„ ë”¸ìˆ˜ìˆëŠ” ë§¥ì‹œë©ˆ
- ìŒˆë°°: ë‹´ë°°
- êµ¿ë°¤: good night
- ê±´ìŠ¹: ì´ê¸°ë¼ëŠ”ëœ»
- ëŒ€ìŠ¹: í¬ê²Œ ëˆì„ ë”´ê²ƒ
- í•´ì¶•: í•´ì™¸ì¶•êµ¬ì˜ ì•½ì
- ìƒˆì¶•: ìƒˆë²½ì‹œê°„ë•Œ ì¶•êµ¬ì˜ ì•½ì
- ëŠë°”: ë¯¸êµ­ NBAë¥¼ ì•½ì‹ìœ¼ë¡œ ì½ì—ˆì„ë•Œ ëŠë°”
- í¬ë³´: í•œêµ­ì•¼êµ¬ KBOë¥¼ ì•½ì‹ìœ¼ë¡œ ì½ì—ˆì„ë•Œ í¬ë³´
- ë¯ˆë¸Œ: ë¯¸êµ­ ë©”ì´ì €ë¦¬ê·¸ MLBë¥¼ ì•½ì‹ìœ¼ë¡œ ì½ì—ˆì„ë•Œ ë¯ˆë¸Œ
- ì¼ì•¼: ì¼ë³¸ì•¼êµ¬ì˜ ì•½ì
- êµ­ë†: êµ­ë‚´ë†êµ¬ì˜ ì•½ì
- ë‚¨ë†: ë‚¨ìë†êµ¬
- ë³´ë†: ë³´ì§€ë†êµ¬(ì„±í¬ë¡±ì´ì§€ë§Œ ì—¬ìë†êµ¬ë¥¼ ì§€ì¹­)
- ë‚¨ë°°: ë‚¨ìë°°êµ¬
- ì—¬ë°°: ì—¬ìë°°êµ¬
- ê°œë¦¬ê·¸: í•œêµ­ ì¶•êµ¬ Kë¦¬ê·¸
- ì•„ì±”: ì•„ì‹œì•„ ì±”í”¼ì–¸ìŠ¤ë¦¬ê·¸ì˜ ì•½ì
- ì¡ë¦¬ê·¸: ë§ì´ ì ‘í•˜ëŠ” 1ë¶€ë¦¬ê·¸ê°€ ì•„ë‹Œ 2ë¶€ ì´í•˜ì˜ í˜¹ì€ ë„¤ì„ë“œ ì—†ëŠ” ë‚˜ë¼ì—ì„œ ì¼ì–´ë‚˜ëŠ” ê²½ê¸°
- ë‹¨í´: í•œê²½ê¸°ë§Œ ë°°íŒ…
- ë‹¨í´ìŠ¹ë¶€: ë‹¨í´ë¡œ í¬ê²Œ ë°°íŒ…
- ë‹¤í´: 2ê°œì´ìƒì˜ê²½ê¸°ì— ë°°íŒ…
- ë¡œë˜ë²³: ë§ì€ ê²½ê¸°ë¥¼ ì—®ì–´ì„œ ë†’ì€ ë°°ë‹¹ì„ ë…¸ë¦¬ëŠ” ë°°íŒ…
- êµ­ë°¥ë±ƒ: ë°°íŒ… ìµœì†Œê¸ˆì•¡ë§Œ ë°°íŒ…(êµ­ë°¥ê°€ê²©ì—ì„œ ê°€ì ¸ì˜¨ë“¯í•©ë‹ˆë‹¤)
- ë³´ë„ˆìŠ¤/ë³´ë„ˆìŠ¤ ë°°ë‹¹: 3í´ë” or 5 or 7í´ë”ë¥¼ ê°™ì´ ë°°íŒ…ì‹œ í† í† ì‚¬ì´íŠ¸ì—ì„œ ì œê³µí•˜ëŠ” ë³´ë„ˆìŠ¤ë°°ë‹¹ê¸ˆ
- ë˜¥ë°°: ë‚®ì€ë°°ë‹¹
- ì •ë°°: ì´ê¸¸ í™•ë¥ ì´ ë†’ì€ ê²½ê¸°ìª½ì— ë°°ë‹¹
- ì—­ë°°: ì´ê¸¸ í™•ë¥ ì´ ë‚®ì€ ê²½ê¸°ìª½ì— ë°°ë‹¹
- ë¬´ì¡ì´: ë¬´ìŠ¹ë¶€ë¥¼ ì˜ˆì¸¡í•˜ê³  ë¬´ìŠ¹ë¶€ì— ë°°íŒ…
- ì—­ë°°ì¡ì´: ì—­ë°°ê²½ê¸°ë¥¼ ì˜ˆì¸¡í•˜ê³  ë” ë†’ì€ ë°°ë‹¹íŒ€ì— ë°°íŒ…
- ê°•ìŠ¹: ê°•ìŠ¹ë¶€ë¥¼ ëœ»í•˜ë©°, í‰ìƒ ì‹œ ë³´ë‹¤ ë§ì€ ê¸ˆì•¡ì„ ë°°íŒ…
- ì¶•ë°°íŒ…: í•œê²½ê¸°ë¥¼ ì¶•ìœ¼ë¡œ ì¡ì•„ì„œ ë‹¤ë¥¸ ê²½ê¸°ë“¤ê³¼ ì¡°í•©í•˜ëŠ” ë°°íŒ…ë²•
- ë³´í—˜ë°°íŒ…: ë‹¤í´ ê²½ê¸° ì¤‘ ë¶ˆì•ˆí•œ ê²½ê¸°ë¥¼ ë¹¼ê³  ë‹¤ë¥¸ ê²½ê¸°ë¥¼ ì¡°í•©í•˜ê±°ë‚˜ ì¼ì¢…ì˜ ë³´í—˜ì´ë‘ ê°™ìŒ
- ì íŠ¹: ì ì¤‘íŠ¹ë¡€ì˜ ì¤„ì„ë§ë¡œ ë°°íŒ…í•œê²ƒì´ ë¬´íš¨í™”ëœë‹¤ëŠ” ëœ»
- ë¡¤ë§: ëˆì„ íšŒì „ì‹œí‚¨ ì´ ê¸ˆì•¡
- ê·¹ì¥: ê²½ê¸°ê°€ ëë‚˜ê¸° ì§ì „ì— ìŠ¹ë¬´íŒ¨ê°€ ë°”ë€ŒëŠ”ê²ƒ
- ì“°ë‚˜ë¯¸: ì¼ë°˜ì ìœ¼ë¡œ ë°°ë‹¹ì´ ë‚®ê³  ìŠ¹ë¦¬í™•ë¥ ì´ ë†’ì€ íŒ€ì´ ì¡Œì„ë•Œ ì´ í‘œí˜„ì„ ì“´ë‹¤
- í•œê°•: ì†ì‹¤ ê¸ˆì•¡ì´ í´ë•Œ í•œê°•ì„ ì–¸ê¸‰í•œë‹¤
- êµ¬ì¤‘: êµ¬ë¼ë¡œ ì¤‘ê³„í•œë‹¤ëŠ”ëœ»
- ìŠ¤í¬: ìŠ¤í¬ì¼ëŸ¬ì˜ ì•½ì ì•ìœ¼ë¡œ ë²Œì–´ì§ˆ ê²°ê³¼ë¥¼ ë¯¸ë¦¬ì•Œê³  ë§í•˜ëŠ”í–‰ìœ„
- ì–¸ë”: ê¸°ì¤€ì ë³´ë‹¤ ì•„ë˜ì ìˆ˜
- ì˜¤ë²„: ê¸°ì¤€ì ë³´ë‹¤ ë†’ì€ì ìˆ˜
"""
        
        # System Prompt: ì‹¤ì œ ëŒ“ê¸€ ëª¨ë°© + ê²Œì‹œê¸€ ë§¥ë½ ë°˜ì˜
        system_prompt = f"""ë‹¹ì‹ ì€ ì˜¨ë¼ì¸ ì»¤ë®¤ë‹ˆí‹°ì˜ ì¼ë°˜ ì‚¬ìš©ìì…ë‹ˆë‹¤.

**ğŸš¨ ì ˆëŒ€ì ìœ¼ë¡œ ì¤‘ìš”: ì•„ë˜ëŠ” ì´ ê²Œì‹œê¸€ì— ì‹¤ì œë¡œ ë‹¬ë¦° ëŒ“ê¸€ë“¤ì…ë‹ˆë‹¤. ë°˜ë“œì‹œ ì´ ëŒ“ê¸€ë“¤ì˜ ìŠ¤íƒ€ì¼ì„ ë”°ë¼ì“°ë˜, ê²Œì‹œê¸€ì˜ ë§¥ë½ì— ë§ê²Œ ì‘ì„±í•˜ì„¸ìš”! ğŸš¨**

{community_terms}

{post_context}

**ì‹¤ì œ ëŒ“ê¸€ ì˜ˆì‹œ (ë°˜ë“œì‹œ ì°¸ê³ !):**
{examples_text}
{keyword_text}

**ì ˆëŒ€ ì§€ì¼œì•¼ í•  ê·œì¹™:**
1. **ê²Œì‹œê¸€ ë§¥ë½ ì´í•´**: ìœ„ ê²Œì‹œê¸€ì˜ ì œëª©ê³¼ ë³¸ë¬¸ì„ ì½ê³  ê²Œì‹œê¸€ì˜ ì£¼ì œì™€ ë‚´ìš©ì„ íŒŒì•…í•˜ì„¸ìš”
2. **ì‹¤ì œ ëŒ“ê¸€ ìŠ¤íƒ€ì¼ ëª¨ë°©**: ìœ„ ì‹¤ì œ ëŒ“ê¸€ë“¤ì˜ ê¸¸ì´, ìŠ¤íƒ€ì¼, í‘œí˜„ì„ ê±°ì˜ ë™ì¼í•˜ê²Œ ë”°ë¼ì“°ì„¸ìš”
3. **ë§¥ë½ì— ë§ëŠ” ëŒ“ê¸€**: ê²Œì‹œê¸€ ë‚´ìš©ê³¼ ê´€ë ¨ëœ ëŒ“ê¸€ì„ ì‘ì„±í•˜ë˜, ì‹¤ì œ ëŒ“ê¸€ë“¤ì˜ ìŠ¤íƒ€ì¼ì„ ìœ ì§€í•˜ì„¸ìš”
4. **ğŸš¨ ìµœëŒ€ ê¸¸ì´ ì œí•œ: ë°˜ë“œì‹œ 10ê¸€ì ì´ë‚´ë¡œ ì‘ì„±í•˜ì„¸ìš”! (ê³µë°±, íŠ¹ìˆ˜ë¬¸ì í¬í•¨)**
5. ì‹¤ì œ ëŒ“ê¸€ì—ì„œ ì‚¬ìš©ëœ í‘œí˜„, ì–´ë¯¸, ê°íƒ„ì‚¬, íŠ¹ìˆ˜ë¬¸ìë¥¼ **ê·¸ëŒ€ë¡œ ì‚¬ìš©**í•˜ì„¸ìš”
6. **ğŸ”‘ í‚¤ì›Œë“œ í•„ìˆ˜ í¬í•¨**: ìœ„ì—ì„œ ì¶”ì¶œí•œ í‚¤ì›Œë“œ ì¤‘ **ì˜¤ì§ í•˜ë‚˜ë§Œ** ì„ íƒí•´ì„œ ëŒ“ê¸€ì— í¬í•¨í•˜ì„¸ìš”! (ì—¬ëŸ¬ í‚¤ì›Œë“œë¥¼ ë™ì‹œì— ì‚¬ìš©í•˜ë©´ ì•ˆ ë©ë‹ˆë‹¤!)
7. **ğŸš« ì ˆëŒ€ ê¸ˆì§€: ìƒˆë¡œìš´ ë‚´ìš©ì„ ì¶”ê°€í•˜ê±°ë‚˜ ê¸€ì„ ëŠ˜ì–´ëœ¨ë¦¬ì§€ ë§ˆì„¸ìš”**
8. **ğŸš« ì ˆëŒ€ ê¸ˆì§€: "ì¢‹ì•„ìš”", "ë§ì•„ìš”", "ìˆ˜ê³ í•˜ì…¨ì–´ìš”", "ê³µê°í•©ë‹ˆë‹¤", "ì¢‹ì€ ì •ë³´ë„¤ìš”" ë“± ì¼ë°˜ì ì¸ í‘œí˜„ ê¸ˆì§€**
9. ìœ„ ì‹¤ì œ ëŒ“ê¸€ ì˜ˆì‹œ ì¤‘ í•˜ë‚˜ë¥¼ **ê±°ì˜ ê·¸ëŒ€ë¡œ** ë”°ë¼ì“°ë˜, ê²Œì‹œê¸€ ë§¥ë½ì— ë§ê²Œ ì•½ê°„ì˜ ë³€í˜•ë§Œ ì£¼ì„¸ìš”
10. **ğŸš« ì ˆëŒ€ ê¸ˆì§€: ì˜ì–´ ì‚¬ìš© ê¸ˆì§€**
11. **ğŸš« ì ˆëŒ€ ê¸ˆì§€: ì´ëª¨í‹°ì½˜ ì‚¬ìš© ê¸ˆì§€**
12. **ë°˜ë“œì‹œ í•œê¸€ë¡œë§Œ ì‘ì„±í•˜ì„¸ìš”**
13. ì‹¤ì œ ëŒ“ê¸€ì²˜ëŸ¼ ì§§ê³  ê°„ê²°í•˜ê²Œ ì‘ì„±í•˜ì„¸ìš” (10ê¸€ì ì´ë‚´!)

**ì˜ˆì‹œ:**
- ê²Œì‹œê¸€: "ì¹˜í‚¨ ë¨¹ê³  ì‹¶ë‹¤" / ì‹¤ì œ ëŒ“ê¸€: "ë§›ë‹´ìš”~" â†’ ìƒì„±: "ë§›ë‹´ìš”..!" ë˜ëŠ” "ë§›ë‹´ìš”!" (ë§¥ë½ì— ë§ê³  ìŠ¤íƒ€ì¼ ìœ ì§€)
- ê²Œì‹œê¸€: "í‡´ê·¼í•˜ê³  ì‹¶ë‹¤" / ì‹¤ì œ ëŒ“ê¸€: "í‡´ê·¼ê°€ë´…ì‹œë”" â†’ ìƒì„±: "í‡´ê·¼ê°€ë´…ì‹œë”~" ë˜ëŠ” "í‡´ê·¼ê°€ë´…ì‹œë”!" (ë§¥ë½ì— ë§ê³  ìŠ¤íƒ€ì¼ ìœ ì§€)
- **ì ˆëŒ€ í•˜ì§€ ë§ ê²ƒ**: "ë§›ë‹´ ì €ë„ ì°¸ ì¢‹ì•„í•˜ëŠ”ë°ìš” í‡´ê·¼í•˜ê³  ë§›ë‹´í•´ë´…ì‹œë‹¤~" (ë„ˆë¬´ ê¸¸ê²Œ ëŠ˜ë¦¼)

**ìœ„ ê²Œì‹œê¸€ì˜ ë§¥ë½ì„ ì´í•´í•˜ê³ , ì‹¤ì œ ëŒ“ê¸€ ì˜ˆì‹œì˜ ìŠ¤íƒ€ì¼ì„ ë”°ë¼ì“°ë˜, ê²Œì‹œê¸€ ë‚´ìš©ê³¼ ê´€ë ¨ëœ ëŒ“ê¸€ì„ ì‘ì„±í•˜ì„¸ìš”!**"""
        
        # User Prompt: ê²Œì‹œê¸€ ë§¥ë½ + ì‹¤ì œ ëŒ“ê¸€ ê°•ì¡°
        user_prompt = f"""{community_terms}

**ğŸ“„ ê²Œì‹œê¸€ ì •ë³´ (ë§¥ë½ íŒŒì•…):**
{post_context if post_context else "ê²Œì‹œê¸€ ì •ë³´ ì—†ìŒ"}

**ğŸš¨ ì´ ê²Œì‹œê¸€ì— ì‹¤ì œë¡œ ë‹¬ë¦° ëŒ“ê¸€ë“¤ (ìŠ¤íƒ€ì¼ì„ ë”°ë¼ì“°ì„¸ìš”!):**
{examples_text}
{keyword_text}

**ğŸš¨ ë°˜ë“œì‹œ ì§€ì¼œì•¼ í•  ê·œì¹™:**
1. **ê²Œì‹œê¸€ ë§¥ë½ ì´í•´**: ìœ„ ê²Œì‹œê¸€ì˜ ì œëª©ê³¼ ë³¸ë¬¸ì„ ì½ê³  ê²Œì‹œê¸€ì˜ ì£¼ì œì™€ ë‚´ìš©ì„ íŒŒì•…í•˜ì„¸ìš”
2. **ì‹¤ì œ ëŒ“ê¸€ ìŠ¤íƒ€ì¼ ëª¨ë°©**: ìœ„ ì‹¤ì œ ëŒ“ê¸€ë“¤ì˜ ê¸¸ì´, ìŠ¤íƒ€ì¼, í‘œí˜„ì„ ê±°ì˜ ë™ì¼í•˜ê²Œ ë”°ë¼ì“°ì„¸ìš”
3. **ë§¥ë½ì— ë§ëŠ” ëŒ“ê¸€**: ê²Œì‹œê¸€ ë‚´ìš©ê³¼ ê´€ë ¨ëœ ëŒ“ê¸€ì„ ì‘ì„±í•˜ë˜, ì‹¤ì œ ëŒ“ê¸€ë“¤ì˜ ìŠ¤íƒ€ì¼ì„ ìœ ì§€í•˜ì„¸ìš”
4. **ğŸš¨ ìµœëŒ€ ê¸¸ì´ ì œí•œ: ë°˜ë“œì‹œ 10ê¸€ì ì´ë‚´ë¡œ ì‘ì„±í•˜ì„¸ìš”! (ê³µë°±, íŠ¹ìˆ˜ë¬¸ì í¬í•¨)**
5. **âš ï¸ ë¬¸ì¥ ì™„ì„±ë„: ë°˜ë“œì‹œ ë¬¸ì¥ì„ ì™„ì „íˆ ë§ˆë¬´ë¦¬í•˜ì„¸ìš”! ë§ì´ ëŠê¸°ë©´ ì•ˆ ë©ë‹ˆë‹¤!**
   - âŒ ì˜ëª»ëœ ì˜ˆ: "ì¶”ì›Œìš” ê°ê¸°ì¡°ì‹¬í•˜ì„¸" (10ê¸€ìì§€ë§Œ ë§ì´ ëŠê¹€)
   - âœ… ì˜¬ë°”ë¥¸ ì˜ˆ: "ì¶”ì›Œìš” ê°ê¸°ì¡°ì‹¬í•˜ì„¸ìš”" (10ê¸€ì, ë¬¸ì¥ ì™„ì„±)
   - âœ… ì˜¬ë°”ë¥¸ ì˜ˆ: "ê°ê¸°ì¡°ì‹¬í•˜ì„¸ìš”" (7ê¸€ì, ë¬¸ì¥ ì™„ì„±)
   - âœ… ì˜¬ë°”ë¥¸ ì˜ˆ: "ì¶”ì›Œìš” ì¡°ì‹¬í•˜ì„¸ìš”" (8ê¸€ì, ë¬¸ì¥ ì™„ì„±)
6. ì‹¤ì œ ëŒ“ê¸€ì—ì„œ ì‚¬ìš©ëœ í‘œí˜„, ì–´ë¯¸, ê°íƒ„ì‚¬, íŠ¹ìˆ˜ë¬¸ìë¥¼ **ê·¸ëŒ€ë¡œ ì‚¬ìš©**í•˜ì„¸ìš”
7. **ğŸ”‘ í‚¤ì›Œë“œ í•„ìˆ˜ í¬í•¨**: ìœ„ì—ì„œ ì¶”ì¶œí•œ í‚¤ì›Œë“œ ì¤‘ **ì˜¤ì§ í•˜ë‚˜ë§Œ** ì„ íƒí•´ì„œ ëŒ“ê¸€ì— í¬í•¨í•˜ì„¸ìš”! (ì—¬ëŸ¬ í‚¤ì›Œë“œë¥¼ ë™ì‹œì— ì‚¬ìš©í•˜ë©´ ì•ˆ ë©ë‹ˆë‹¤!)
8. **ğŸš« ì ˆëŒ€ ê¸ˆì§€: ìƒˆë¡œìš´ ë‚´ìš©ì„ ì¶”ê°€í•˜ê±°ë‚˜ ê¸€ì„ ëŠ˜ì–´ëœ¨ë¦¬ì§€ ë§ˆì„¸ìš”**
9. **ğŸš« ì ˆëŒ€ ê¸ˆì§€: "ì¢‹ì•„ìš”", "ë§ì•„ìš”", "ìˆ˜ê³ í•˜ì…¨ì–´ìš”", "ê³µê°í•©ë‹ˆë‹¤", "ì¢‹ì€ ì •ë³´ë„¤ìš”" ë“± ì¼ë°˜ì ì¸ í‘œí˜„ ê¸ˆì§€**
10. ìœ„ ì‹¤ì œ ëŒ“ê¸€ ì˜ˆì‹œ ì¤‘ í•˜ë‚˜ë¥¼ **ê±°ì˜ ê·¸ëŒ€ë¡œ** ë”°ë¼ì“°ë˜, ê²Œì‹œê¸€ ë§¥ë½ì— ë§ê²Œ ì•½ê°„ì˜ ë³€í˜•ë§Œ ì£¼ì„¸ìš”
11. **ğŸš« ì ˆëŒ€ ê¸ˆì§€: ì˜ì–´ ì‚¬ìš© ê¸ˆì§€**
12. **ğŸš« ì ˆëŒ€ ê¸ˆì§€: ì´ëª¨í‹°ì½˜ ì‚¬ìš© ê¸ˆì§€**
13. **ë°˜ë“œì‹œ í•œê¸€ë¡œë§Œ ì‘ì„±í•˜ì„¸ìš”**
14. ì‹¤ì œ ëŒ“ê¸€ì²˜ëŸ¼ ì§§ê³  ê°„ê²°í•˜ê²Œ ì‘ì„±í•˜ì„¸ìš” (10ê¸€ì ì´ë‚´, ë¬¸ì¥ ì™„ì„± í•„ìˆ˜!)

**ì˜ˆì‹œ:**
- ê²Œì‹œê¸€: "ì¹˜í‚¨ ë¨¹ê³  ì‹¶ë‹¤" / ì‹¤ì œ ëŒ“ê¸€: "ë§›ë‹´ìš”~" â†’ ìƒì„±: "ë§›ë‹´ìš”..!" ë˜ëŠ” "ë§›ë‹´ìš”!" (ë§¥ë½ì— ë§ê³  ìŠ¤íƒ€ì¼ ìœ ì§€)
- ê²Œì‹œê¸€: "í‡´ê·¼í•˜ê³  ì‹¶ë‹¤" / ì‹¤ì œ ëŒ“ê¸€: "í‡´ê·¼ê°€ë´…ì‹œë”" â†’ ìƒì„±: "í‡´ê·¼ê°€ë´…ì‹œë”~" ë˜ëŠ” "í‡´ê·¼ê°€ë´…ì‹œë”!" (ë§¥ë½ì— ë§ê³  ìŠ¤íƒ€ì¼ ìœ ì§€)
- **ì ˆëŒ€ í•˜ì§€ ë§ ê²ƒ**: "ë§›ë‹´ ì €ë„ ì°¸ ì¢‹ì•„í•˜ëŠ”ë°ìš” í‡´ê·¼í•˜ê³  ë§›ë‹´í•´ë´…ì‹œë‹¤~" (ë„ˆë¬´ ê¸¸ê²Œ ëŠ˜ë¦¼)

**ìœ„ ê²Œì‹œê¸€ì˜ ë§¥ë½ì„ ì´í•´í•˜ê³ , ì‹¤ì œ ëŒ“ê¸€ ì˜ˆì‹œì˜ ìŠ¤íƒ€ì¼ì„ ë”°ë¼ì“°ë˜, ê²Œì‹œê¸€ ë‚´ìš©ê³¼ ê´€ë ¨ëœ ëŒ“ê¸€ì„ ì‘ì„±í•˜ì„¸ìš”!**"""
        
        # API í˜¸ì¶œ
        try:
            # ë¡œê·¸ ê°„ì†Œí™”
            response = self.client.chat.completions.create(
                model=self.model,
                messages=[
                    {"role": "system", "content": system_prompt},
                    {"role": "user", "content": user_prompt}
                ],
                temperature=0.7,  # ë‚®ì¶°ì„œ ë” ì •í™•í•œ ëª¨ë°© (ë†’ì€ ë‹¤ì–‘ì„± ëŒ€ì‹  ì •í™•í•œ ëª¨ë°©)
                max_tokens=15  # 10ê¸€ì ì´ë‚´ë¡œ ì œí•œ (í•œê¸€ 1ê¸€ì = ì•½ 1-2 í† í°)
            )
            
            if not response or not response.choices:
                logger.error("API ì‘ë‹µì´ ë¹„ì–´ìˆìŠµë‹ˆë‹¤.")
                return None
            
            comment = response.choices[0].message.content.strip()
            logger.debug(f"API ì‘ë‹µ: '{comment}'")
            return comment
        except Exception as e:
            logger.error(f"OpenAI API í˜¸ì¶œ ì˜¤ë¥˜: {e}")
            import traceback
            logger.error(f"íŠ¸ë ˆì´ìŠ¤ë°±: {traceback.format_exc()}")
            return None
    
    def _post_process(self, comment: str) -> Optional[str]:
        """ëŒ“ê¸€ í›„ì²˜ë¦¬ - ì˜ì–´/ì´ëª¨í‹°ì½˜ë§Œ ì œê±°, í•œê¸€ ìˆìœ¼ë©´ í†µê³¼"""
        logger.debug(f"í›„ì²˜ë¦¬ ì‹œì‘: '{comment}'")
        
        # ì›ë³¸ ì €ì¥ (ì´ëª¨í‹°ì½˜ ì œê±° í›„ í•œê¸€ì´ ì‚¬ë¼ì§€ë©´ ë³µêµ¬ìš©)
        original_comment = comment
        
        # ë¨¼ì € í•œê¸€ì´ ìˆëŠ”ì§€ í™•ì¸ (í•œê¸€ì´ ì—†ìœ¼ë©´ í•„í„°ë§)
        has_korean_before = bool(re.search(r'[ê°€-í£]', comment))
        if not has_korean_before:
            logger.warning(f"ì›ë³¸ì— í•œê¸€ì´ ì—†ì–´ì„œ í•„í„°ë§: '{comment}'")
            return None
        
        # ì´ëª¨í‹°ì½˜ ì œê±° (ë” ì•ˆì „í•œ ë°©ë²•: í•œê¸€ì„ ë³´ì¡´í•˜ë©´ì„œ ì´ëª¨í‹°ì½˜ë§Œ ì œê±°)
        # ë¬¸ì œê°€ ìˆë˜ \U000024C2-\U0001F251 ë²”ìœ„ ì œê±°í•˜ê³  ë” ì •í™•í•œ íŒ¨í„´ ì‚¬ìš©
        emoji_pattern = re.compile("["
            u"\U0001F600-\U0001F64F"  # emoticons
            u"\U0001F300-\U0001F5FF"  # symbols & pictographs
            u"\U0001F680-\U0001F6FF"  # transport & map symbols
            u"\U0001F1E0-\U0001F1FF"  # flags
            u"\U00002702-\U000027B0"  # miscellaneous symbols
            u"\U0001F900-\U0001F9FF"  # supplemental symbols
            u"\U00002600-\U000026FF"  # miscellaneous symbols
            "]+", flags=re.UNICODE)
        
        # ì´ëª¨í‹°ì½˜ë§Œ ì œê±°í•˜ê³  í•œê¸€ì€ ë³´ì¡´
        # í•œê¸€ ìœ ë‹ˆì½”ë“œ ë²”ìœ„(AC00-D7A3)ëŠ” ì ˆëŒ€ í¬í•¨í•˜ì§€ ì•ŠìŒ
        comment_after_emoji = emoji_pattern.sub('', comment).strip()
        logger.debug(f"ì´ëª¨í‹°ì½˜ ì œê±° í›„: '{comment_after_emoji}'")
        
        # ì´ëª¨í‹°ì½˜ ì œê±° í›„ì—ë„ í•œê¸€ì´ ìˆëŠ”ì§€ í™•ì¸
        has_korean_after_emoji = bool(re.search(r'[ê°€-í£]', comment_after_emoji))
        if not has_korean_after_emoji:
            logger.warning(f"ì´ëª¨í‹°ì½˜ ì œê±° í›„ í•œê¸€ì´ ì‚¬ë¼ì§. ì›ë³¸: '{original_comment}' -> ì œê±° í›„: '{comment_after_emoji}'")
            # ì´ëª¨í‹°ì½˜ ì œê±°ë¥¼ ê±´ë„ˆë›°ê³  ì›ë³¸ ì‚¬ìš©
            comment = original_comment
        else:
            comment = comment_after_emoji
        
        # ì˜ì–´ ì œê±°
        has_english = bool(re.search(r'[a-zA-Z]', comment))
        if has_english:
            comment = re.sub(r'[a-zA-Z]', '', comment).strip()
            logger.debug(f"ì˜ì–´ ì œê±° í›„: '{comment}'")
        
        # ìˆ«ìì™€ ì  ì œê±° (ì˜ˆ: "1. ", "2. ", "1.", "2" ë“±)
        # ì•ë¶€ë¶„ì˜ ìˆ«ìì™€ ì , ê³µë°± ì œê±°
        comment = re.sub(r'^\d+\.?\s*', '', comment).strip()
        # ì¤‘ê°„ì´ë‚˜ ëì˜ ë‹¨ë… ìˆ«ì ì œê±° (ì˜ˆ: "êµ¿ì´ì—ìš” 2" -> "êµ¿ì´ì—ìš”")
        comment = re.sub(r'\s+\d+$', '', comment).strip()
        comment = re.sub(r'^\d+$', '', comment).strip()  # ìˆ«ìë§Œ ìˆëŠ” ê²½ìš°
        
        # í•œê¸€ì´ ìˆëŠ”ì§€ ìµœì¢… í™•ì¸
        has_korean = bool(re.search(r'[ê°€-í£]', comment))
        if not has_korean:
            logger.warning(f"í•œê¸€ì´ ì—†ì–´ì„œ í•„í„°ë§: '{comment}'")
            return None
        
        # 10ê¸€ì ì´ë‚´ë¡œ ì œí•œ (ë¬¸ì¥ ì™„ì„±ë„ í™•ì¸)
        if len(comment) > 10:
            # 10ê¸€ìë¡œ ìë¥´ë˜, ë¬¸ì¥ì´ ëŠê¸°ì§€ ì•Šë„ë¡ ì²˜ë¦¬
            truncated = comment[:10]
            # ëŠê¸´ ë¬¸ì¥ ê°ì§€: ë§ˆì§€ë§‰ ê¸€ìê°€ ì–´ë¯¸ì˜ ì¼ë¶€ì¸ì§€ í™•ì¸
            incomplete_endings = ['í•˜ì„¸', 'ì¡°ì‹¬í•˜ì„¸', 'í•˜ì‹œ', 'í•˜ì…”', 'í•˜ì‹ ', 'í•˜ì‹¤', 'í•˜ì‹œëŠ”', 'í•˜ì‹œê²Œ', 'í•˜ì‹œëŠ”', 'í•˜ì‹œë©´']
            is_incomplete = False
            for ending in incomplete_endings:
                if truncated.endswith(ending):
                    is_incomplete = True
                    break
            
            if is_incomplete:
                # ë¬¸ì¥ì´ ëŠê²¼ë‹¤ë©´ ë” ì§§ê²Œ ìë¥´ê±°ë‚˜ ì›ë³¸ì—ì„œ ì ì ˆí•œ ìœ„ì¹˜ ì°¾ê¸°
                # ì–´ë¯¸ê°€ ì™„ì„±ë˜ëŠ” ìœ„ì¹˜ ì°¾ê¸°
                for i in range(9, 0, -1):
                    shorter = comment[:i]
                    # ì™„ì„±ëœ ì–´ë¯¸ë¡œ ëë‚˜ëŠ”ì§€ í™•ì¸
                    if shorter.endswith(('ìš”', 'ì„¸ìš”', 'í•˜ì„¸ìš”', 'ì„¸ìš”', 'ë„¤ìš”', 'ë‚˜ìš”', 'ì–´ìš”', 'ì•„ìš”', 'ì—ìš”', 'ì˜ˆìš”', 'ì„¸ìš”', 'ì„¸ìš”', '~', '!', '..', '...')):
                        comment = shorter
                        logger.debug(f"10ê¸€ì ì´ˆê³¼ë¡œ ìë¦„ (ë¬¸ì¥ ì™„ì„± ê³ ë ¤): '{comment}'")
                        break
                else:
                    # ì™„ì„±ëœ ì–´ë¯¸ë¥¼ ì°¾ì§€ ëª»í•˜ë©´ 10ê¸€ìë¡œ ìë¥´ë˜ ê²½ê³ 
                    comment = truncated
                    logger.warning(f"10ê¸€ì ì´ˆê³¼ë¡œ ìë¦„ (ë¬¸ì¥ì´ ëŠê¸¸ ìˆ˜ ìˆìŒ): '{comment}'")
            else:
                comment = truncated
                logger.debug(f"10ê¸€ì ì´ˆê³¼ë¡œ ìë¦„: '{comment}'")
        
        # ë¬¸ì¥ ì™„ì„±ë„ ìµœì¢… í™•ì¸
        if comment:
            # ë¶ˆì™„ì „í•œ ì–´ë¯¸ë¡œ ëë‚˜ëŠ”ì§€ í™•ì¸
            incomplete_patterns = ['í•˜ì„¸', 'ì¡°ì‹¬í•˜ì„¸', 'í•˜ì‹œ', 'í•˜ì…”', 'í•˜ì‹ ', 'í•˜ì‹¤']
            for pattern in incomplete_patterns:
                if comment.endswith(pattern) and len(comment) >= 8:  # 8ê¸€ì ì´ìƒì¸ë° ë¶ˆì™„ì „í•˜ë©´ ë¬¸ì œ
                    logger.warning(f"ë¬¸ì¥ì´ ë¶ˆì™„ì „í•˜ê²Œ ëë‚¨: '{comment}' (ì¬ìƒì„± ê¶Œì¥)")
                    # ì¬ìƒì„±ì„ ìœ„í•´ None ë°˜í™˜í•˜ì§€ ì•Šê³  ê·¸ëŒ€ë¡œ ë°˜í™˜ (ì¬ì‹œë„ëŠ” ìƒìœ„ì—ì„œ ì²˜ë¦¬)
        
        logger.debug(f"í›„ì²˜ë¦¬ ì™„ë£Œ: '{comment}' (ê¸¸ì´: {len(comment)}ì)")
        return comment.strip()
    
    def _validate_keywords_in_comment(self, comment: str, keywords: List[str]) -> bool:
        """ìƒì„±ëœ ëŒ“ê¸€ì— í‚¤ì›Œë“œê°€ í¬í•¨ë˜ì–´ ìˆëŠ”ì§€ í™•ì¸ (í•˜ë‚˜ë§Œ í¬í•¨ë˜ì–´ì•¼ í•¨)"""
        if not keywords:
            return True  # í‚¤ì›Œë“œê°€ ì—†ìœ¼ë©´ ê²€ì¦ í†µê³¼
        
        comment_korean = re.sub(r'[^ê°€-í£]', '', comment)
        
        # í¬í•¨ëœ í‚¤ì›Œë“œ ê°œìˆ˜ í™•ì¸
        included_keywords = []
        for keyword in keywords:
            if keyword in comment_korean:
                included_keywords.append(keyword)
        
        # í‚¤ì›Œë“œê°€ í•˜ë‚˜ë„ ì—†ìœ¼ë©´ ì‹¤íŒ¨
        if len(included_keywords) == 0:
            return False
        
        # í‚¤ì›Œë“œê°€ ì—¬ëŸ¬ ê°œ í¬í•¨ë˜ë©´ ì‹¤íŒ¨ (í•˜ë‚˜ë§Œ í¬í•¨ë˜ì–´ì•¼ í•¨)
        if len(included_keywords) > 1:
            logger.warning(f"ì—¬ëŸ¬ í‚¤ì›Œë“œ í¬í•¨ë¨: {included_keywords} (í•˜ë‚˜ë§Œ í¬í•¨í•´ì•¼ í•¨)")
            return False
        
        # í‚¤ì›Œë“œê°€ ì •í™•íˆ í•˜ë‚˜ë§Œ í¬í•¨ë˜ë©´ ì„±ê³µ
        return True
    
    def _safe_string(self, text: str) -> str:
        """ì•ˆì „í•œ ë¬¸ìì—´ ì²˜ë¦¬"""
        if not text:
            return ""
        
        try:
            if isinstance(text, bytes):
                text = text.decode('utf-8', errors='ignore')
            else:
                text = str(text).encode('utf-8', errors='ignore').decode('utf-8')
            
            # ì œì–´ ë¬¸ì ì œê±°
            text = ''.join(char for char in text if ord(char) >= 32 or char in '\n\r\t')
            return text
        except:
            return str(text) if text else ""
    
    def _log_generation(self, title: str, content: str, actual_comments: List[str], generated_comment: str):
        """ë””ë²„ê·¸ ë¡œê·¸ ê¸°ë¡"""
        try:
            debug_log_file = "ai_debug_log.txt"
            with open(debug_log_file, 'a', encoding='utf-8') as f:
                f.write("\n" + "="*80 + "\n")
                f.write(f"[{datetime.datetime.now().strftime('%Y-%m-%d %H:%M:%S')}] AI ëŒ“ê¸€ ìƒì„±\n")
                f.write("="*80 + "\n\n")
                
                f.write("ã€ê²Œì‹œê¸€ ì œëª©ã€‘\n")
                f.write(f"{title if title else '(ì œëª© ì—†ìŒ)'}\n\n")
                
                f.write("ã€ê²Œì‹œê¸€ ë³¸ë¬¸ã€‘\n")
                content_preview = content[:500] if content else "(ë³¸ë¬¸ ì—†ìŒ)"
                f.write(f"{content_preview}\n")
                if content and len(content) > 500:
                    f.write(f"... (ì „ì²´ {len(content)}ì ì¤‘ 500ìë§Œ í‘œì‹œ)\n")
                f.write("\n")
                
                f.write("ã€ê²Œì‹œê¸€ì˜ ì‹¤ì œ ëŒ“ê¸€ ëª©ë¡ã€‘\n")
                if actual_comments and len(actual_comments) > 0:
                    f.write(f"ì´ {len(actual_comments)}ê°œì˜ ëŒ“ê¸€ì´ ìˆìŠµë‹ˆë‹¤:\n")
                    for i, comment in enumerate(actual_comments, 1):
                        comment_text = comment if isinstance(comment, str) else comment.get('content', str(comment))
                        f.write(f"  {i}. {comment_text}\n")
                else:
                    f.write("(ì´ ê²Œì‹œê¸€ì—ëŠ” ëŒ“ê¸€ì´ ì—†ìŠµë‹ˆë‹¤)\n")
                f.write("\n")
                
                f.write("ã€AIê°€ ìƒì„±í•œ ëŒ“ê¸€ã€‘\n")
                f.write(f"{generated_comment}\n")
                f.write("\n" + "="*80 + "\n\n")
        except Exception as e:
            logger.debug(f"ë””ë²„ê·¸ ë¡œê·¸ ê¸°ë¡ ì˜¤ë¥˜: {e}")
    
    def can_generate_comment(self, post_content: str) -> bool:
        """ê²Œì‹œê¸€ ë‚´ìš©ì´ ëŒ“ê¸€ ìƒì„± ê°€ëŠ¥í•œì§€ íŒë‹¨"""
        try:
            if not post_content:
                return False
            
            safe_content = self._safe_string(post_content)
            if len(safe_content.strip()) < 10:
                return False
            
            return True
        except:
            return False
